---
layout:     post                    # 使用的布局（不需要改）
title:      FOC                # 标题 
subtitle:    第一篇                  #副标题
date:       2018-06-04              # 时间
author:     BY Edlward              # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - FOC
---
[RevPark_Circle_Limitation](https://www.amobbs.com/thread-5687439-1-1.html?_dsign=79458593)  


[无刷换相](https://bbs.dji.com/thread-74728-1-1.html)  
[原理](https://wenku.baidu.com/view/a25e526d580102020740be1e650e52ea5518cebd.html)  
[动画](https://www.bilibili.com/video/av21127592/?p=3)  


[怎样理解永磁同步电机控制中的“矢量控制”](https://www.zhihu.com/question/20724715)  

[永磁同步电机矢量控制之——“基础”](https://zhuanlan.zhihu.com/p/23267332)  

[如何快速理解永磁同步电机？](https://zhuanlan.zhihu.com/p/45757542)  

[stm32 死区 刹车 pwm](https://blog.csdn.net/gtkknd/article/details/52840629) 

[PWM输入模式捕捉4路PWM的周期和占空比](https://wenku.baidu.com/view/8e83f253e87101f69f31951f.html)  

[STM32电机培训online，大佬带你玩电机](http://www.stmcu.org.cn/module/forum/thread-612763-1-1.html)  

[如何理解永磁电机各种电感？](https://zhuanlan.zhihu.com/p/47255694)  

###
[atan2与极坐标](https://blog.csdn.net/ronnie_hu/article/details/69053413)  
[伺服电机编码器与转子磁极相位对齐方法](https://blog.csdn.net/Still8912/article/details/45460051)  
[霍尔传感器直线电机位置检测](https://wenku.baidu.com/view/190e722410a6f524cdbf8525.html)  
[电角度](https://wenku.baidu.com/view/93dd2d355ef7ba0d4b733b2c.html?from=search)  
[PMSM 控制技术探究与仿真1：三相PMSM的数学建模与坐标变换](https://blog.csdn.net/huagengpai1994/article/details/84575418)  
```
https://en.wikipedia.org/wiki/Atan2

ATan2与ATan的区别
相比较ATan，ATan2究竟有什么不同？本篇介绍一下ATan2的用法及使用条件。

对于tan(θ) = y / x:

θ = ATan(y / x)求出的θ取值范围是[-PI/2, PI/2]。

θ = ATan2(y, x)求出的θ取值范围是[-PI, PI]。

当 (x, y) 在第一象限, 0 < θ < PI/2.

当 (x, y) 在第二象限 PI/2 < θ≤PI.

当 (x, y) 在第三象限, -PI < θ < -PI/2.

当 (x, y) 在第四象限, -PI/2 < θ < 0.

当点(x, y)在象限的边界也就是坐标轴上时:

当 y 是 0，x 为非负值, θ = 0.

当 y 是 0， x 是 负值, θ = PI.

当 y 是 正值， x 是 0, θ = PI/2.

当 y 是 负值， x 是 0, θ = -PI/2.

由此可知，一般情况下用ATan即可，当对所求出角度的取值范围有特殊要求时，应使用ATan2。


```

1、编码器测出的是机械角度，电角度应该=机械角度X电机极对数。2、PARK和其反变换是使用电气角度；至于为什么使用电气角度，请研究一下大家看着算法。3、“定子磁场比转子磁场超前90度怎么体现？”，先把控制原理搞懂了再去做项目。不知道LZ是在校学生还是公司职员？另外，直接拿来主义是行不通的，TI的例子仅能作参考，离产品还有很长一截距离。


FOC基本调试方法

         在很多对电机的控制中，都需要对电机的速度或者角度位置精准的控制。在这些控制中大部分PID环节和FOC算法都是需要调试的，一般调试的原则是从内到外，调节步骤如下：
1.先从FOC算法开始调试，采用SVPWM，先调试这个模块，人为地给两个Ualpha Ubeta，确保电机能运行，确认svpwm没问题
然后人为vq，Vd给个值；
2.确认上面之后开始调试采样电流和编码器的电角度输出；
3.人为给定Id_ref=0和Iq_ref=xxx，通过实时采样电流，调试电流环的PID，调节的目标是启动响应速度足够快，平衡运行波动足够小；通过DAC输出实时的采样电流来进行观测调试；
4.人为给定速度，调试速度环PID，输出Iq_ref，调节的目标是根据需要在足够宽的速度范围内平稳启动和运行，目前根据速度的范围分段调试PID；
5.位置环的调节，输出速度，调节目标，从一个位置快速的到达另一个位置来回跑，停止静差足够小，速度的增减足够快即瞬时速度大且需要合理的根据位置路径的长度规划一个速度曲线；
大致的FOC调试方法就是这样了




  上图中，u,v,w为三相绕组，2极的意思是极对数为2，也就是说有2极×3相=6块小扇区。可以看到N从V到达下一个V对于三相电流而言走完了一个完整的周期又回到了初始状态，但是电机并没有转完一整圈。换言之，如果电机完整转完一圈，那么对于三相电流而言不过是重复了极对数遍周期过程。所以控制上直接讨论的是电角度，然后换算到机械角度。多机电机的显而易见的：转矩和转速的控制更精确、转动更平滑。缺点是多极电机的电动势中高次谐波增加，齿槽转矩增加，由高次谐波引起的损耗增加。


--------------------- 
作者：未过河的卒 
来源：CSDN 
原文：https://blog.csdn.net/huagengpai1994/article/details/84575418 
版权声明：本文为博主原创文章，转载请附上博文链接！


A2-1 绕组边都处于磁极 S2 极下。现假设转子逆时针转过了一个角度，使得 A1-2 和 A2-1
都处于磁极 S3 之下，见图 1-29(b)。从物理上讲，每对磁极都是相同的，不同的磁极编号是
人为加上去的；所以在定子绕组看来，图(a)和图(b)的磁场情况是完全相同的，故而这即是
一个完整周期，期间应该完成全部的 6 次换相

