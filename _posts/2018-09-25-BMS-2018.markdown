---
layout:     post                    # 使用的布局（不需要改）
title:      BMS                # 标题 
subtitle:    第一篇                  #副标题
date:       2018-09-25              # 时间
author:     BY Edlward              # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - BMS
---

[浅析锂电池保护板（BMS）系统设计思路](https://www.cnblogs.com/han-bing/p/9045812.html)  
[NTC——热敏电阻的采集方法](https://blog.csdn.net/u014470361/article/details/82315699)  
[热敏电阻温度计算 公式 程序](https://blog.csdn.net/yangyang_1024/article/details/80563522)  

### 热敏电阻和温度转换公式和程序

NTC 热敏电阻温度计算公式Rt = R *EXP(B*(1/T1-1/T2))

这里T1和T2指的是K度即开尔文温度，K度=273.15(绝对温度)+摄氏度；

其中T2=(273.15+25)Rt 是热敏电阻在T1温度下的阻值；

R是热敏电阻在T2常温下的标称阻值；

B值是热敏电阻的重要参数；

EXP是e的n次方； 

 转换得：1/T1 =ln(Rt/R)/B+1/T2，求TI，然后再减去273.15就是实际温度，同时+0.5的误差矫正。



程序：
```
#include "math.h"

const float Rp=10000.0;             //10K
const float T2 = (273.15+25.0); //T2
const float Bx = 3950.0;              //B
const float Ka = 273.15;

float temp;


while(1)
{
temp = 1/(log(Rt/Rp)/Bx + (1/T2));
temp = (temp - Ka + 0.5)*10;
LCD_ShowxNum(86,150,temp,5,16,0x80);  //显示温度
}
```


将各步拆分如下：
```
float Get_Temp(void)
{
float Rt;
float temp;
Rt = Get_TempResistor();   //获得电阻值
//like this R=5000, T2=273.15+25,B=3470, RT=5000*EXP(3470*(1/T1-1/(273.15+25)),  
temp = Rt/Rp;
temp = log(temp); //ln(Rt/Rp)
temp/=Bx; //ln(Rt/Rp)/B
temp+=(1/T2); //ln(Rt/Rp)/B+（1/T2）
temp = 1/(temp);
temp-=Ka;
temp+=0.5; //加0.5误差矫正
return temp;
} 
```



锂离子电池容量计算之电压法
锂离子电池容量计算之电压法     

锂离子电池开路电压与电池容量的对应关系分析 
　　 
　　先给出一个表格:如下,百分比是电池的剩余容量,右侧是对应的电池的开路电压(OCV). 
　　100%----4.20V 
　　90%-----4.06V 
　　80%-----3.98V 
　　70%-----3.92V 
　　60%-----3.87V 
　　50%-----3.82V 
　　40%-----3.79V 
　　30%-----3.77V 
　　20%-----3.74V 
　　10%-----3.68V 
　　5%------3.45V 
　　0%------3.00V 
　　 
　　以前发过一个"如何判断电池的剩余容量",写得不够详细,且数据不够精确. 
　　此次整理了一下试验数据,作为上篇文章的更新. 
　　 
　　以下是这个表格的来龙去脉. 
　　 
　　〓〓〓〓〓〓〓〓 
　　一.首先几个概念解释: 
　　1.OCV:open circuit voltage的缩写,开路电压. 
　　 
　　2.锂离子电池:本篇讨论的是目前手机上普遍采用的以4.2V恒压限制充电的单节锂离子电池. 
　　 
　　3.mAh:电池容量的计量单位,实际就是电池中可以释放为外部使用的电子的总数. 
　　 折合物理上的标准的单位就是大家熟悉的库仑. 
　　 库仑的国际标准单位为电流乘于时间的安培秒. 
　　 1mAh=0.001安培*3600秒=3.6安培秒=3.6库仑 
　　 mAh不是标准单位,但是这个单位可以很方便的用于计量和计算. 
　　 比如一颗900mAh的电池可以提供300mA恒流的持续3小时的供电能力. 
　　 
　　4.fuel gauging:电量计量,原意是油量计量,后在电化学上被引用为电量计量的意思. 
　　 最科学的并且是最原始的电池的电量计量方法是对流经的电子流量的统计.即库仑计(coulomb count). 
　　 
　　★要想获得锂离子电池的电量使用的正确情况,只有用库仑计.就象大家家里面的水量计量用的水表的作用原理.要计算流经的电荷的多少才能获得锂离子电池的电量使用情况. 
　　 
　　〓〓〓〓〓〓〓〓 
　　二.电压与容量的关系 
　　但是锂离子电池有一个对电量计量很有用的特性,就是在放电的时候,电池电压随电量的流逝会逐渐降低,并且有相当大的斜率.这就提供给我们另外一种近似的电量计量途径.取电池电压的方法.就好像测量水箱里面的水面高度可以大概估计剩余的水量这个道理一样.但是实际上电池的电压比水箱里面的平静的水面高度测量要复杂的多. 
　　 
　　用电压来估计电池的剩余容量有以下几个不稳定性: 
　　1.同一个电池,在同等剩余容量的情况下,电压值因放电电流的大小而变化. 
　　 放电电流越大,电压越低.在没有电流的情况下,电压最高. 
　　2.环境温度对电池电压的影响, 温度越低,同等容量电池电压越低. 
　　3.循环对电池放电平台的影响, 
　　 随着循环的进行,锂离子电池的放电平台趋于恶化.放电平台降低.所以相同电压所代表的容量也相应变化了. 
　　4.不同厂家,不同容量的锂离子电池,其放电的平台略有差异. 
　　5.不同类型的电极材料的锂离子电池,放电平台有较大差异.钴锂和锰锂的放电平台就完全不同. 
　　 以上这些都会造成电压的波动和电压的差异,使电池的容量显示变的不稳定 
　　★★一台手机上用电压计量电池容量时,因为手机不可能一直处于小电流的待机状态.暂时的大电流的损耗,比如开背光,放铃声,特别是通过,都会造成电池电压很快降低.此时手机显示的容量要降低得比实际容量降低更多.而当大电流撤掉以后,电池的电压会回升.这就会造成手机容量显示反而上升这种不合理的现象. 
　　 
　　〓〓〓〓〓〓〓〓〓〓〓 
　　三.电池电压对电池容量的表格 
　　说了这么多,下面给出一个标准的电压对电池剩余容量的表格(左侧) 
　　以及大电流恒流放电是电池电压对容量的表格(右侧) 
　　 
　　标准条件描述: 
　　1.室温 
　　2.新的电池 
　　3.完全充饱以后进行GSM模拟放电 
　　4.测量电池电压时,关断放电回路,测量电池开路电压.排除放电电流对电压的影响. 
　　5.选用钴锂的电池,因为目前手机上大多选用的是钴锂.锰锂很少. 
　　 
　　大电流恒流放电条件描述: 
　　1.室温 
　　2.新的电池 
　　3.完全充饱以后进行550mA的恒流放电 
　　4.测量电池电压时,不关断放电回路,测量电池实际工作电压.携带放电电流对电压的影响. 
　　5.选用钴锂的电池,因为目前手机上大多选用的是钴锂.锰锂很少. 
　　 
　　★★★★★ 
　　具体数据如下,以10%的容量间隔进行划分 
　　 
　　OCV电压对容量关系 550mA恒流放电电压对容量关系 
　　100%----4.20V 100%----4.20V 
　　90%-----4.06V 90%-----3.97V 
　　80%-----3.98V 80%-----3.87V 
　　70%-----3.92V 70%-----3.79V▲ 
　　60%-----3.87V 60%-----3.73V 
　　50%-----3.82V 50%-----3.68V 
　　40%-----3.79V▲ 40%-----3.65V 
　　30%-----3.77V 30%-----3.62V 
　　20%-----3.74V 20%-----3.58V 
　　10%-----3.68V 10%-----3.51V 
　　5%------3.45V 5%------3.42V 
　　0%------3.00V 0%------3.00V 
　　★★★★★ 
　　以上数据为我三年来对锂离子电池测试的统计, 
　　因为电池电压的影响因素实在太多,表中的仅供各位参考. 
　　 
　　注意这里电池电压与容量不是线性关系.也没有其它公式可以套用.手机只能实现制备一个对应的表格来对照实际测量到的电压,来近似取得电池的容量. 
　　 
　　锂离子电池的OCV放电电压在4.20V到3.90V之间下降斜率较快. 
　　在3.8V前后有一个相对平缓的放电平台 
　　在低于3.7V以后,电压随容量下降急剧降低到3.0V 
　　而对照的大电流放电(1C)的放电平台出现在3.65V左右 
　　 
　　由对比表格可以看到. 
　　如果长时间处于大电流放电状态,当电压降到3.79V时, 
　　手机这个时候认为只有40%(参考左侧)的电量.而实际电池应该还有70%的电量(参考右侧).当手机重新进入小电流待机时,电池电压会回升到对应左侧的3.92V(70%).那么手机的容量显示就会出现反跳现象. 
　　 
　　-------------------------------------- 
　　四.手机上采用测量电压法来计量电池容量的具体应用: 
　　 
　　1.手机设计的电量显示就是根据这个电压对容量的关系来设置手机上电量的显示. 
　　2.常用的电量格.有三格或四格的.以四格电量的显示来讲. 
　　 各个手机设计时每一格代表的电量并不一定是平均的25%. 
　　 实际情况往往可能是第一格代表了50%或者更多.第二格代表20%.....是一种不平均的分配. 
　　 波导S1200的第一格电量就代表了前面的60%以上的电量. 
　　 厦新A8的第一格电量代表了前面的70%左右的电量. 
　　 其它三星手机,philips的都有各自不同的格子定义. 
　　 当然采用这种原理的也有用百分比来显示的(就象上面的百分比). 
　　3.但是只要是采用电压来计量容量原理来工作的手机,这个电量就不可避免的存在下述弊端 
　　 电量的精度(分辨率)不高.三格,四格或10格(就象上面的百分比). 
　　 电量会出现反复变化,比如打完一个电话后从两格降低到一格后,过一会儿又反弹回两格这种现象. 
　　4.手机对电池电压的采样,一般会尽量采用低消耗电流时的电压(比如待机时), 
　　 这时获得的电压比较有参考价值. 
　　 而且手机软件会采用"多点采样计算平均值"的算法来避免瞬间电流对电压的干扰. 
　　5.手机里面设定容量格数的电压临界值是固定不变的. 
　　 而电池随着循环的进行或选用放电平台很差的电池时,其对应的剩余容量会出现很大的差异 
　　 比如放电平台高的电池,其第一格所代表的电量可以用3天,而循环了100次的电池和差的劣质电池. 
　　 其第一格电量却只能用1到2天.甚至出现在电量为空格的时候却还可以待机2天的怪异现象. 
　　6.在处理电压反跳现象时,有些手机会采用锁定容量格数的一个算法.即容量显示不反跳,但是当前的容量格数的使用时间会相对延长一点. 
　　7.有些早期的手机使用的是镍氢电池或镍镉电池, 
　　 同样镍基电池也可以绘出一个放电电压对容量的关系.其原理也是一样的.这里不另行详细说明. 
　　 
　　-------------------------------------- 
　　总之,采用测量电池电压来计量电池容量是个简单易行,但是略显粗糙的方法. 
　　真正高级的锂离子电池电量计量只有采用库仑计并使用高级的电量计量算法. 
　　关于手机电池里面的库仑计(爱立信的手机普遍试用了库仑计)有机会以后再讨论! 
